{% extends 'page.html' %}

{% block canonical_link %}{{ url_for('.person', person_id=person.id) }}{% endblock %}

{% block title %}{{ person.name }} mentions - Election Mentions{% endblock %}

{% if '2015' in person.candidacies %}
    {% set person_party=person.candidacies['2015'].party.name %}
    {% set person_constituency=person.candidacies['2015'].constituency.name %}
    {% set person_constituency_id=person.candidacies['2015'].constituency.id %}
    {% set person_year="2015" %}
{% elif '2010' in person.candidacies %}
    {% set person_party=person.candidacies['2010'].party.name %}
    {% set person_constituency=person.candidacies['2010'].constituency.name %}
    {% set person_constituency_id=person.candidacies['2010'].constituency.id %}
    {% set person_year="2010" %}
{% else %}
    {% set person_party="" %}
    {% set person_constituency="" %}
    {% set person_constituency_id="" %}
    {% set person_year="" %}
{% endif %}

{% block content %}
<div class='container'>
  {% include "header.html" %}
</div>
<div style='background:#516FFF;'>
  <div class='container'>
    <div class='row'>
      <div class='col-md-12 top-banner'>
        <div class='name'>
          <h1>{{ person.name }}</h1>
        </div>
      </div>
    </div>
  </div>
</div>
<div style='background:#FAFAFA;margin-bottom:20px;'>
  <div class='container'>
    <div class='row'>
      <div class='col-md-12 top-banner'>
      {% if person_party %}
      <div class='party-and-constituency'>
          <h2>{{ person_party }} &mdash; <a href='{{ url_for('.constituency', constituency_id=person_constituency_id) }}'>{{ person_constituency }}</a> <small>(GE {{ person_year }})</small></h2>
      </div>
      {% else %}
      <div class='party-and-constituency'>
          <h2>No known candidacies</h2>
      </div>
      {% endif %}

      {% if person.deleted %}
        <p class='text-danger'>This person has been deleted</p>
      {% endif %}
      </div>
    </div>
  </div>
</div>
<div class='container'>
  <div class='row'>
    <div class='col-md-12'>
<style>
svg.timeline circle {
    fill: white;
    stroke:rgba(128,128,128,1.0);
    stroke-width:2 
}

svg.timeline line {
    stroke:rgba(128,128,128,1.0);
    stroke-width:2
}
</style>
{% set start_time=articles[-1].order_date %}
{% set finish_time=articles[0].order_date %}
{% set interval=finish_time - start_time %}

{{ start_time }}
{{ finish_time }}
{{ interval }}
<svg width="100%" height="120" class="timeline">
  <line x1="5%" y1="60" x2="95%" y2="60"/>
{% for article in articles %}
  <circle cx="{{ (article.order_date - start_time).total_seconds()/interval.total_seconds() * 90 + 5}}%" cy="60" r="10"></circle>
{% endfor %}
</svg>
    </div>
  </div>
</div>
<div class='container'>
  <div class='row'>
    <div class='col-md-2 col-sm-3'>
      {% if person.image %}
        <img width='100%' class='person-image' src='{{ person.proxy_image }}/0/165' alt='Photo of {{ person.name }}'/>
      {% endif %}
      {% for year, candidacy in person.candidacies.items() %}
      <p class='person-candidacy'>
          <span class='year'>GE {{ year }}</span>
          {% if candidacy.party %}
          <span class='party'>{{ candidacy.party.name }}</span>
          {% endif %}
          {% if candidacy.constituency %}
          <span class='constituency'><a href='{{ url_for('.constituency', constituency_id=candidacy.constituency.id) }}'>{{ candidacy.constituency.name }}</a></span>
          {% endif %}
      </p>
      {% endfor %}

      <a href='http://yournextmp.com/person/{{ person.id }}'>View {{ person.name }} on YourNextMP</a>
    </div>
    {#<div class='col-md-10'>
      {% include "article_add_form.html" %}
    </div>#}
    {#<div class='col-md-10 col-sm-9'>
        <ul class='tab-nav'>
            <li><a href='{{ url_for('.person', person_id=person.id) }}'>quotes</a></li>
            <li><a href='{{ url_for('.person_articles', person_id=person.id) }}'>articles</a></li>
        </ul>
    </div>#}
    <div class='col-md-10 col-sm-9'>
        <p class='warning'>These are automatically matched articles and extracted quotes that we think are talking about {{ person.name }}. There may be errors. For example, the article may be talking about a different {{ person.name }}.</p>
        <h3>Quotes mentioning {{ person.name }}</h3>
        <ul class='quotes'>
        {% if quotes %}
        {% for quote in quotes[:5] %}
            <li class='quote'>
                <p class='quote-text'>{{ quote.html|safe }}</p>
                <p style='float: left;' class='quote-article-link'><a href='{{ url_for("article_report", doc_id=quote.article._id) }}'>report</a></p>
                <p class='quote-article-link'>
                    {% if quote.article.page.date_published %}
                        published {{ quote.article.page.date_published.strftime("%-d %b %Y") }} 
                    {% endif %}
                    in <a href='{{ quote.article.page.urls[0] }}'>{{ quote.article.page.title }}</a> ({{ quote.article.domain }})</p>
            </li>
        {% endfor %}
        </ul>
        <a href='{{ url_for('.person_quotes', person_id=person.id) }}' class='btn btn-default'>see all quotes mentioning {{ person.name }}</a>
        {% else %}
        <p class='warning'>We don't know of any quotes mentioning {{ person.name }}.</p>
        {% endif %}

        <h3>Articles mentioning {{ person.name }}</h3>
        {% set num_articles=articles|length %}
        {% if num_articles == 0 %}
        <p class='warning'>We don't know of any news articles about {{ person.name }}. Why not <a href='http://www.google.com/#q={{ person.name }} {{ person_constituency }} {{ person_party }}'>try to find one</a> and add it?</p>
        {% include "article_add_form.html" %}
        {% else %}
        {#<p class='warning'>These are automatically matched pages that we think are talking about {{ person.name }}. There may be errors. For example, the article may be talking about a different {{ person.name }}.</p>#}
        {% set quotes_closed=False %}
        {% include "article_list.html" %}
        <script>
            {% for year, candidacy in person.candidacies.items() %}
            $('.quote-constituency-{{ candidacy.constituency.id }}').removeClass('quote-closed').show();
            $('.quote-constituency-{{ candidacy.constituency.id }}-highlight').addClass("constituency-highlight");
            {% endfor %}

            $('.quote-candidate-{{ person.id }}').removeClass('quote-closed').show();
            $('.quote-candidate-{{ person.id }}-highlight').addClass("candidate-highlight");

            /*recalculate_extra_quotes();*/
        </script>
        {% endif %}
    </div>
  </div>
</div>
<div class='footer'>
<div class='container'>
  {% include "footer.html" %}
</div>
</div>
{% endblock content %}
